<!doctype html>
<html lang="th" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meeting Room Booking</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Kanit', sans-serif; }
    .room-mind { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .room-reality { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .room-power { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .room-space { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
    .room-mind-light { background: rgba(102, 126, 234, 0.15); border-left: 3px solid #667eea; }
    .room-reality-light { background: rgba(240, 147, 251, 0.15); border-left: 3px solid #f093fb; }
    .room-power-light { background: rgba(79, 172, 254, 0.15); border-left: 3px solid #4facfe; }
    .room-space-light { background: rgba(67, 233, 123, 0.15); border-left: 3px solid #43e97b; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); }
    .time-slot:hover { background: rgba(102, 126, 234, 0.1); }
    .booking-card { transition: all 0.2s ease; }
    .booking-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .modal-overlay { backdrop-filter: blur(4px); }
    .date-picker-day {
      padding: 0.5rem;
      text-align: center;
      font-size: 0.875rem;
      cursor: pointer;
      border-radius: 0.5rem;
      transition: all 0.2s;
      border: 1px solid transparent;
    }
    .date-picker-day:hover { background: rgba(102, 126, 234, 0.1); }
    .date-picker-day.other-month { color: #cbd5e1; }
    .date-picker-day.selected { background: #667eea; color: white; font-weight: 600; }
    .date-picker-day.today { border: 2px solid #667eea; }
    .date-picker-day.disabled { color: #cbd5e1; cursor: not-allowed; }
    .pulse-dot { animation: pulse 2s infinite; }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .slide-in { animation: slideIn 0.3s ease; }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
 </head>
 <body class="h-full bg-slate-50 overflow-auto">
  <div id="app" class="h-full w-full flex flex-col"><!-- Header -->
   <header class="bg-white border-b border-slate-200 px-4 py-3 flex items-center justify-between flex-shrink-0">
    <div class="flex items-center gap-3">
     <div class="w-10 h-10 room-mind rounded-xl flex items-center justify-center">
      <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
     </div>
     <div>
      <h1 id="app-title" class="text-xl font-semibold text-slate-800">Meeting Room Booking</h1>
      <p class="text-xs text-slate-500">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</p>
     </div>
    </div><button onclick="openBookingModal()" class="room-mind text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 hover:opacity-90 transition">
     <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
     </svg> ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° </button>
   </header><!-- Navigation -->
   <div class="bg-white border-b border-slate-200 px-4 py-2 flex items-center justify-between flex-shrink-0">
    <div class="flex items-center gap-2"><button onclick="navigateMonth(-1)" class="p-2 hover:bg-slate-100 rounded-lg transition">
      <svg class="w-5 h-5 text-slate-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg></button> <button onclick="goToToday()" class="px-3 py-1.5 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded-lg transition">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button> <button onclick="navigateMonth(1)" class="p-2 hover:bg-slate-100 rounded-lg transition">
      <svg class="w-5 h-5 text-slate-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg></button>
     <h2 id="current-month" class="text-lg font-semibold text-slate-800 ml-2"></h2>
    </div>
    <div class="flex items-center gap-2"><select id="view-mode" onchange="changeView(this.value)" class="px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"> <option value="month">‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option> <option value="week">‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option> <option value="day">‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏ß‡∏±‡∏ô</option> </select> <select id="room-filter" onchange="filterByRoom(this.value)" class="px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"> <option value="all">‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á</option> <option value="Mind Room">üü£ Mind Room</option> <option value="Reality Room">üî¥ Reality Room</option> <option value="Power Room">üîµ Power Room</option> <option value="Space Room">üü¢ Space Room</option> </select>
    </div>
   </div><!-- Room Legend -->
   <div class="bg-white border-b border-slate-200 px-4 py-2 flex items-center gap-4 flex-shrink-0 overflow-x-auto"><span class="text-sm text-slate-500 flex-shrink-0">‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°:</span>
    <div class="flex items-center gap-1 flex-shrink-0"><span class="w-3 h-3 rounded-full room-mind"></span> <span class="text-sm text-slate-700">Mind Room</span>
    </div>
    <div class="flex items-center gap-1 flex-shrink-0"><span class="w-3 h-3 rounded-full room-reality"></span> <span class="text-sm text-slate-700">Reality Room</span>
    </div>
    <div class="flex items-center gap-1 flex-shrink-0"><span class="w-3 h-3 rounded-full room-power"></span> <span class="text-sm text-slate-700">Power Room</span>
    </div>
    <div class="flex items-center gap-1 flex-shrink-0"><span class="w-3 h-3 rounded-full room-space"></span> <span class="text-sm text-slate-700">Space Room</span>
    </div>
   </div><!-- Calendar Container -->
   <div id="calendar-container" class="flex-1 overflow-auto p-4"><!-- Calendar will be rendered here -->
   </div>
  </div><!-- Booking Modal -->
  <div id="booking-modal" class="fixed inset-0 bg-black/50 modal-overlay hidden items-center justify-center z-50 p-4">
   <div class="bg-white rounded-2xl w-full max-w-lg max-h-[90%] overflow-y-auto slide-in">
    <div class="p-6 border-b border-slate-200">
     <div class="flex items-center justify-between">
      <h3 id="modal-title" class="text-xl font-semibold text-slate-800">‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h3><button onclick="closeBookingModal()" class="p-2 hover:bg-slate-100 rounded-lg transition">
       <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
    </div>
    <form id="booking-form" class="p-6 space-y-4"><input type="hidden" id="booking-id"> <input type="hidden" id="recurrence-group-id">
     <div><label class="block text-sm font-medium text-slate-700 mb-1">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° *</label> <input type="text" id="booking-title" required class="w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ó‡∏µ‡∏° Marketing">
     </div>
     <div><label class="block text-sm font-medium text-slate-700 mb-1">‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° *</label>
      <div class="grid grid-cols-2 gap-2"><label class="cursor-pointer"> <input type="radio" name="room" value="Mind Room" class="peer hidden" required>
        <div class="p-3 border-2 border-slate-200 rounded-lg peer-checked:border-indigo-500 peer-checked:bg-indigo-50 transition">
         <div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full room-mind"></span> <span class="font-medium text-slate-700">Mind Room</span>
         </div>
        </div></label> <label class="cursor-pointer"> <input type="radio" name="room" value="Reality Room" class="peer hidden">
        <div class="p-3 border-2 border-slate-200 rounded-lg peer-checked:border-pink-500 peer-checked:bg-pink-50 transition">
         <div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full room-reality"></span> <span class="font-medium text-slate-700">Reality Room</span>
         </div>
        </div></label> <label class="cursor-pointer"> <input type="radio" name="room" value="Power Room" class="peer hidden">
        <div class="p-3 border-2 border-slate-200 rounded-lg peer-checked:border-blue-500 peer-checked:bg-blue-50 transition">
         <div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full room-power"></span> <span class="font-medium text-slate-700">Power Room</span>
         </div>
        </div></label> <label class="cursor-pointer"> <input type="radio" name="room" value="Space Room" class="peer hidden">
        <div class="p-3 border-2 border-slate-200 rounded-lg peer-checked:border-emerald-500 peer-checked:bg-emerald-50 transition">
         <div class="flex items-center gap-2"><span class="w-4 h-4 rounded-full room-space"></span> <span class="font-medium text-slate-700">Space Room</span>
         </div>
        </div></label>
      </div>
     </div>
     <div class="grid grid-cols-2 gap-4">
      <div><label class="block text-sm font-medium text-slate-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà *</label>
       <div class="relative"><input type="text" id="booking-date-display" required class="w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none cursor-pointer bg-white" onclick="toggleDatePicker()" readonly placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"> <input type="hidden" id="booking-date">
        <div id="date-picker" class="hidden absolute top-full left-0 mt-2 bg-white border border-slate-200 rounded-lg shadow-xl z-20 p-4 w-80">
         <div>
          <div class="flex items-center justify-between mb-4"><button type="button" onclick="prevPickerMonth()" class="p-1.5 hover:bg-slate-100 rounded-lg transition">
            <svg class="w-4 h-4 text-slate-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg></button>
           <div class="text-center">
            <div id="picker-month-label" class="font-semibold text-slate-800"></div>
           </div><button type="button" onclick="nextPickerMonth()" class="p-1.5 hover:bg-slate-100 rounded-lg transition">
            <svg class="w-4 h-4 text-slate-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg></button>
          </div>
          <div class="grid grid-cols-7 gap-1 mb-2">
           <div class="text-center text-xs text-slate-500 font-medium p-2">
            ‡∏≠‡∏≤
           </div>
           <div class="text-center text-xs text-slate-500 font-medium p-2">
            ‡∏à
           </div>
           <div class="text-center text-xs text-slate-500 font-medium p-2">
            ‡∏≠
           </div>
           <div class="text-center text-xs text-slate-500 font-medium p-2">
            ‡∏û
           </div>
           <div class="text-center text-xs text-slate-500 font-medium p-2">
            ‡∏û‡∏§
           </div>
           <div class="text-center text-xs text-slate-500 font-medium p-2">
            ‡∏®
           </div>
           <div class="text-center text-xs text-slate-500 font-medium p-2">
            ‡∏™
           </div>
          </div>
          <div id="date-picker-grid" class="grid grid-cols-7 gap-1"></div>
         </div>
        </div>
       </div>
      </div>
      <div><label class="block text-sm font-medium text-slate-700 mb-1">‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ã‡πâ‡∏≥</label> <select id="recurrence-type" class="w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"> <option value="none">‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥</option> <option value="daily">‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô</option> <option value="weekly">‡∏ó‡∏∏‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option> <option value="biweekly">‡∏ó‡∏∏‡∏Å 2 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option> <option value="monthly">‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option> </select>
      </div>
     </div>
     <div id="recurrence-end-container" class="hidden"><label class="block text-sm font-medium text-slate-700 mb-1">‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ã‡πâ‡∏≥</label>
      <div class="relative"><input type="text" id="recurrence-end-display" class="w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none cursor-pointer bg-white" onclick="toggleRecurrencePicker()" readonly placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"> <input type="hidden" id="recurrence-end">
       <div id="recurrence-picker" class="hidden absolute top-full left-0 mt-2 bg-white border border-slate-200 rounded-lg shadow-xl z-20 p-4 w-80">
        <div>
         <div class="flex items-center justify-between mb-4"><button type="button" onclick="prevRecurrenceMonth()" class="p-1.5 hover:bg-slate-100 rounded-lg transition">
           <svg class="w-4 h-4 text-slate-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
           </svg></button>
          <div class="text-center">
           <div id="recurrence-picker-label" class="font-semibold text-slate-800"></div>
          </div><button type="button" onclick="nextRecurrenceMonth()" class="p-1.5 hover:bg-slate-100 rounded-lg transition">
           <svg class="w-4 h-4 text-slate-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
           </svg></button>
         </div>
         <div class="grid grid-cols-7 gap-1 mb-2">
          <div class="text-center text-xs text-slate-500 font-medium p-2">
           ‡∏≠‡∏≤
          </div>
          <div class="text-center text-xs text-slate-500 font-medium p-2">
           ‡∏à
          </div>
          <div class="text-center text-xs text-slate-500 font-medium p-2">
           ‡∏≠
          </div>
          <div class="text-center text-xs text-slate-500 font-medium p-2">
           ‡∏û
          </div>
          <div class="text-center text-xs text-slate-500 font-medium p-2">
           ‡∏û‡∏§
          </div>
          <div class="text-center text-xs text-slate-500 font-medium p-2">
           ‡∏®
          </div>
          <div class="text-center text-xs text-slate-500 font-medium p-2">
           ‡∏™
          </div>
         </div>
         <div id="recurrence-picker-grid" class="grid grid-cols-7 gap-1"></div>
        </div>
       </div>
      </div>
     </div>
     <div class="grid grid-cols-2 gap-4">
      <div><label class="block text-sm font-medium text-slate-700 mb-1">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° *</label> <select id="booking-start" required class="w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"> </select>
      </div>
      <div><label class="block text-sm font-medium text-slate-700 mb-1">‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î *</label> <select id="booking-end" required class="w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"> </select>
      </div>
     </div>
     <div><label class="block text-sm font-medium text-slate-700 mb-1">‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</label> <input type="text" id="booking-attendees" class="w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="‡πÄ‡∏ä‡πà‡∏ô john@email.com, jane@email.com">
     </div>
     <div><label class="block text-sm font-medium text-slate-700 mb-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label> <textarea id="booking-description" rows="3" class="w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none resize-none" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..."></textarea>
     </div>
     <div id="conflict-warning" class="hidden p-3 bg-red-50 border border-red-200 rounded-lg">
      <div class="flex items-center gap-2 text-red-700">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
       </svg><span class="text-sm font-medium">‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≤‡∏ß‡πÅ‡∏•‡πâ‡∏ß</span>
      </div>
     </div>
     <div class="flex gap-3 pt-4"><button type="button" onclick="closeBookingModal()" class="flex-1 px-4 py-2.5 border border-slate-200 text-slate-700 rounded-lg font-medium hover:bg-slate-50 transition">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button> <button type="submit" id="submit-btn" class="flex-1 px-4 py-2.5 room-mind text-white rounded-lg font-medium hover:opacity-90 transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
     </div>
    </form>
   </div>
  </div><!-- View Booking Modal -->
  <div id="view-modal" class="fixed inset-0 bg-black/50 modal-overlay hidden items-center justify-center z-50 p-4">
   <div class="bg-white rounded-2xl w-full max-w-md slide-in">
    <div id="view-modal-header" class="p-6 rounded-t-2xl">
     <div class="flex items-center justify-between">
      <h3 id="view-title" class="text-xl font-semibold text-white"></h3><button onclick="closeViewModal()" class="p-2 hover:bg-white/20 rounded-lg transition">
       <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
    </div>
    <div class="p-6 space-y-4">
     <div class="flex items-center gap-3">
      <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
      </svg><span id="view-room" class="text-slate-700"></span>
     </div>
     <div class="flex items-center gap-3">
      <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg><span id="view-date" class="text-slate-700"></span>
     </div>
     <div class="flex items-center gap-3">
      <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg><span id="view-time" class="text-slate-700"></span>
     </div>
     <div id="view-recurrence-container" class="flex items-center gap-3">
      <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
      </svg><span id="view-recurrence" class="text-slate-700"></span>
     </div>
     <div id="view-attendees-container" class="flex items-start gap-3">
      <svg class="w-5 h-5 text-slate-400 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
      </svg><span id="view-attendees" class="text-slate-700"></span>
     </div>
     <div id="view-description-container" class="flex items-start gap-3">
      <svg class="w-5 h-5 text-slate-400 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
      </svg><span id="view-description" class="text-slate-700"></span>
     </div>
     <div class="flex gap-3 pt-4"><button onclick="editBooking()" class="flex-1 px-4 py-2.5 border border-slate-200 text-slate-700 rounded-lg font-medium hover:bg-slate-50 transition flex items-center justify-center gap-2">
       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
       </svg> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç </button> <button onclick="showDeleteConfirm()" id="delete-btn" class="flex-1 px-4 py-2.5 bg-red-500 text-white rounded-lg font-medium hover:bg-red-600 transition flex items-center justify-center gap-2">
       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
       </svg> ‡∏•‡∏ö </button>
     </div><!-- Delete Confirmation -->
     <div id="delete-confirm" class="hidden pt-2">
      <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
       <p class="text-sm text-red-700 mb-3">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
       <div id="delete-options" class="space-y-2"><button onclick="deleteBooking('single')" class="w-full px-3 py-2 text-sm bg-white border border-red-200 text-red-700 rounded-lg hover:bg-red-50 transition">‡∏•‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ</button> <button onclick="deleteBooking('all')" id="delete-all-btn" class="w-full px-3 py-2 text-sm bg-red-500 text-white rounded-lg hover:bg-red-600 transition">‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏∏‡∏î (‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ã‡πâ‡∏≥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)</button>
       </div><button onclick="hideDeleteConfirm()" class="w-full mt-2 px-3 py-2 text-sm text-slate-600 hover:bg-slate-100 rounded-lg transition">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
     </div>
    </div>
   </div>
  </div><!-- Toast -->
  <div id="toast" class="fixed bottom-4 right-4 bg-slate-800 text-white px-4 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50"><span id="toast-message"></span>
  </div>
  <script>
    // State
    let bookings = [];
    let currentDate = new Date();
    let currentView = 'month';
    let currentRoomFilter = 'all';
    let selectedBooking = null;
    let isEditing = false;
    let pickerDate = new Date();
    let recurrencePickerDate = new Date();

    // Default config
    const defaultConfig = {
      app_title: 'Meeting Room Booking',
      primary_color: '#667eea',
      secondary_color: '#f8fafc',
      text_color: '#1e293b',
      accent_color: '#f093fb',
      border_color: '#e2e8f0'
    };

    // Room colors mapping
    const roomColors = {
      'Mind Room': { class: 'room-mind', light: 'room-mind-light', hex: '#667eea' },
      'Reality Room': { class: 'room-reality', light: 'room-reality-light', hex: '#f093fb' },
      'Power Room': { class: 'room-power', light: 'room-power-light', hex: '#4facfe' },
      'Space Room': { class: 'room-space', light: 'room-space-light', hex: '#43e97b' }
    };

    // Time options
    const timeOptions = [];
    for (let h = 7; h <= 20; h++) {
      for (let m = 0; m < 60; m += 30) {
        const time = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
        timeOptions.push(time);
      }
    }

    // Recurrence labels
    const recurrenceLabels = {
      'none': '‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥',
      'daily': '‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô',
      'weekly': '‡∏ó‡∏∏‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå',
      'biweekly': '‡∏ó‡∏∏‡∏Å 2 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå',
      'monthly': '‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'
    };

    const thaiMonths = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', 
                       '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];

    // Initialize time selects
    function initTimeSelects() {
      const startSelect = document.getElementById('booking-start');
      const endSelect = document.getElementById('booking-end');
      
      startSelect.innerHTML = timeOptions.map(t => `<option value="${t}">${t}</option>`).join('');
      endSelect.innerHTML = timeOptions.map(t => `<option value="${t}">${t}</option>`).join('');
      
      startSelect.value = '09:00';
      endSelect.value = '10:00';
    }

    // Data handler for SDK
    const dataHandler = {
      onDataChanged(data) {
        bookings = data;
        renderCalendar();
      }
    };

    // Initialize
    async function init() {
      initTimeSelects();
      
      // Initialize Element SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
          },
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.primary_color || defaultConfig.primary_color,
                set: (value) => window.elementSdk.setConfig({ primary_color: value })
              },
              {
                get: () => config.secondary_color || defaultConfig.secondary_color,
                set: (value) => window.elementSdk.setConfig({ secondary_color: value })
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => window.elementSdk.setConfig({ text_color: value })
              },
              {
                get: () => config.accent_color || defaultConfig.accent_color,
                set: (value) => window.elementSdk.setConfig({ accent_color: value })
              },
              {
                get: () => config.border_color || defaultConfig.border_color,
                set: (value) => window.elementSdk.setConfig({ border_color: value })
              }
            ],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (config) => new Map([
            ['app_title', config.app_title || defaultConfig.app_title]
          ])
        });
      }

      // Initialize Data SDK
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to initialize data SDK');
        }
      }

      // Event listeners
      document.getElementById('recurrence-type').addEventListener('change', function() {
        const container = document.getElementById('recurrence-end-container');
        if (this.value !== 'none') {
          container.classList.remove('hidden');
          renderRecurrencePicker();
        } else {
          container.classList.add('hidden');
        }
      });

      document.getElementById('booking-form').addEventListener('submit', handleBookingSubmit);

      // Check for conflicts on input change
      ['booking-date', 'booking-start', 'booking-end'].forEach(id => {
        document.getElementById(id).addEventListener('change', checkConflict);
      });
      document.querySelectorAll('input[name="room"]').forEach(input => {
        input.addEventListener('change', checkConflict);
      });

      // Close pickers when clicking outside
      document.addEventListener('click', function(e) {
        if (!e.target.closest('.relative')) {
          document.getElementById('date-picker').classList.add('hidden');
          document.getElementById('recurrence-picker').classList.add('hidden');
        }
      });

      renderCalendar();
    }

    // Date picker functions
    function toggleDatePicker() {
      const picker = document.getElementById('date-picker');
      picker.classList.toggle('hidden');
      if (!picker.classList.contains('hidden')) {
        renderDatePicker();
      }
    }

    function renderDatePicker() {
      updatePickerMonth();
    }

    function updatePickerMonth() {
      const year = pickerDate.getFullYear();
      const month = pickerDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = firstDay.getDay();
      const totalDays = lastDay.getDate();
      const today = new Date();
      const selectedDate = document.getElementById('booking-date').value;

      document.getElementById('picker-month-label').textContent = `${thaiMonths[month]} ${year + 543}`;

      let html = '';
      
      // Empty cells
      for (let i = 0; i < startDay; i++) {
        html += `<div class="date-picker-day other-month"></div>`;
      }

      // Days
      for (let day = 1; day <= totalDays; day++) {
        const dateStr = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
        const isToday = today.getFullYear() === year && today.getMonth() === month && today.getDate() === day;
        const isSelected = selectedDate === dateStr;

        let classes = 'date-picker-day';
        if (isSelected) classes += ' selected';
        if (isToday) classes += ' today';

        html += `
          <button type="button" class="${classes}" onclick="selectDate('${dateStr}'); event.preventDefault();">
            ${day}
          </button>
        `;
      }

      // Empty cells at end
      const remainingCells = (7 - ((startDay + totalDays) % 7)) % 7;
      for (let i = 0; i < remainingCells; i++) {
        html += `<div class="date-picker-day other-month"></div>`;
      }

      document.getElementById('date-picker-grid').innerHTML = html;
    }

    function prevPickerMonth() {
      pickerDate.setMonth(pickerDate.getMonth() - 1);
      updatePickerMonth();
    }

    function nextPickerMonth() {
      pickerDate.setMonth(pickerDate.getMonth() + 1);
      updatePickerMonth();
    }

    function selectDate(dateStr) {
      document.getElementById('booking-date').value = dateStr;
      document.getElementById('booking-date-display').value = formatDateDisplay(dateStr);
      document.getElementById('date-picker').classList.add('hidden');
      checkConflict();
    }

    function formatDateDisplay(dateStr) {
      const [year, month, day] = dateStr.split('-');
      return `${parseInt(day)} ${thaiMonths[parseInt(month) - 1]} ${parseInt(year) + 543}`;
    }

    // Recurrence picker functions
    function toggleRecurrencePicker() {
      const picker = document.getElementById('recurrence-picker');
      picker.classList.toggle('hidden');
      if (!picker.classList.contains('hidden')) {
        renderRecurrencePicker();
      }
    }

    function renderRecurrencePicker() {
      updateRecurrencePickerMonth();
    }

    function updateRecurrencePickerMonth() {
      const year = recurrencePickerDate.getFullYear();
      const month = recurrencePickerDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = firstDay.getDay();
      const totalDays = lastDay.getDate();
      const today = new Date();
      const selectedDate = document.getElementById('recurrence-end').value;

      document.getElementById('recurrence-picker-label').textContent = `${thaiMonths[month]} ${year + 543}`;

      let html = '';
      
      // Empty cells
      for (let i = 0; i < startDay; i++) {
        html += `<div class="date-picker-day other-month"></div>`;
      }

      // Days
      for (let day = 1; day <= totalDays; day++) {
        const dateStr = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
        const isToday = today.getFullYear() === year && today.getMonth() === month && today.getDate() === day;
        const isSelected = selectedDate === dateStr;

        let classes = 'date-picker-day';
        if (isSelected) classes += ' selected';
        if (isToday) classes += ' today';

        html += `
          <button type="button" class="${classes}" onclick="selectRecurrenceDate('${dateStr}'); event.preventDefault();">
            ${day}
          </button>
        `;
      }

      // Empty cells at end
      const remainingCells = (7 - ((startDay + totalDays) % 7)) % 7;
      for (let i = 0; i < remainingCells; i++) {
        html += `<div class="date-picker-day other-month"></div>`;
      }

      document.getElementById('recurrence-picker-grid').innerHTML = html;
    }

    function prevRecurrenceMonth() {
      recurrencePickerDate.setMonth(recurrencePickerDate.getMonth() - 1);
      updateRecurrencePickerMonth();
    }

    function nextRecurrenceMonth() {
      recurrencePickerDate.setMonth(recurrencePickerDate.getMonth() + 1);
      updateRecurrencePickerMonth();
    }

    function selectRecurrenceDate(dateStr) {
      document.getElementById('recurrence-end').value = dateStr;
      document.getElementById('recurrence-end-display').value = formatDateDisplay(dateStr);
      document.getElementById('recurrence-picker').classList.add('hidden');
    }

    // Navigate month
    function navigateMonth(direction) {
      if (currentView === 'month') {
        currentDate.setMonth(currentDate.getMonth() + direction);
      } else if (currentView === 'week') {
        currentDate.setDate(currentDate.getDate() + (direction * 7));
      } else {
        currentDate.setDate(currentDate.getDate() + direction);
      }
      renderCalendar();
    }

    // Go to today
    function goToToday() {
      currentDate = new Date();
      renderCalendar();
    }

    // Change view
    function changeView(view) {
      currentView = view;
      renderCalendar();
    }

    // Filter by room
    function filterByRoom(room) {
      currentRoomFilter = room;
      renderCalendar();
    }

    // Get filtered bookings
    function getFilteredBookings() {
      if (currentRoomFilter === 'all') return bookings;
      return bookings.filter(b => b.room === currentRoomFilter);
    }

    // Render calendar
    function renderCalendar() {
      const container = document.getElementById('calendar-container');
      const monthLabel = document.getElementById('current-month');
      
      const thaiDays = ['‡∏≠‡∏≤', '‡∏à', '‡∏≠', '‡∏û', '‡∏û‡∏§', '‡∏®', '‡∏™'];
      const thaiDaysFull = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'];

      if (currentView === 'month') {
        monthLabel.textContent = `${thaiMonths[currentDate.getMonth()]} ${currentDate.getFullYear() + 543}`;
        container.innerHTML = renderMonthView(thaiDays);
      } else if (currentView === 'week') {
        const weekStart = getWeekStart(currentDate);
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekEnd.getDate() + 6);
        monthLabel.textContent = `${weekStart.getDate()} - ${weekEnd.getDate()} ${thaiMonths[weekEnd.getMonth()]} ${weekEnd.getFullYear() + 543}`;
        container.innerHTML = renderWeekView(thaiDaysFull);
      } else {
        monthLabel.textContent = `${currentDate.getDate()} ${thaiMonths[currentDate.getMonth()]} ${currentDate.getFullYear() + 543}`;
        container.innerHTML = renderDayView();
      }
    }

    // Get week start (Sunday)
    function getWeekStart(date) {
      const d = new Date(date);
      const day = d.getDay();
      d.setDate(d.getDate() - day);
      return d;
    }

    // Render month view
    function renderMonthView(thaiDays) {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = firstDay.getDay();
      const totalDays = lastDay.getDate();
      const today = new Date();

      let html = `
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
          <div class="calendar-grid bg-slate-50 border-b border-slate-200">
            ${thaiDays.map(d => `<div class="p-3 text-center text-sm font-medium text-slate-600">${d}</div>`).join('')}
          </div>
          <div class="calendar-grid">
      `;

      // Empty cells before first day
      for (let i = 0; i < startDay; i++) {
        html += `<div class="min-h-[100px] p-2 border-b border-r border-slate-100 bg-slate-50"></div>`;
      }

      // Days
      for (let day = 1; day <= totalDays; day++) {
        const dateStr = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
        const isToday = today.getFullYear() === year && today.getMonth() === month && today.getDate() === day;
        const dayBookings = getFilteredBookings().filter(b => b.date === dateStr);

        html += `
          <div class="min-h-[100px] p-2 border-b border-r border-slate-100 hover:bg-slate-50 transition cursor-pointer" onclick="openBookingModal('${dateStr}')">
            <div class="flex items-center justify-between mb-1">
              <span class="${isToday ? 'w-7 h-7 flex items-center justify-center rounded-full bg-indigo-500 text-white text-sm font-medium' : 'text-sm text-slate-700'}">${day}</span>
            </div>
            <div class="space-y-1">
              ${dayBookings.slice(0, 3).map(b => `
                <div onclick="event.stopPropagation(); viewBooking('${b.__backendId}')" class="booking-card ${roomColors[b.room]?.light || 'bg-slate-100'} px-2 py-1 rounded text-xs truncate cursor-pointer">
                  <span class="font-medium">${b.start_time}</span> ${b.title}
                </div>
              `).join('')}
              ${dayBookings.length > 3 ? `<div class="text-xs text-slate-500 pl-2">+${dayBookings.length - 3} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>` : ''}
            </div>
          </div>
        `;
      }

      // Empty cells after last day
      const remainingCells = (7 - ((startDay + totalDays) % 7)) % 7;
      for (let i = 0; i < remainingCells; i++) {
        html += `<div class="min-h-[100px] p-2 border-b border-r border-slate-100 bg-slate-50"></div>`;
      }

      html += `</div></div>`;
      return html;
    }

    // Render week view
    function renderWeekView(thaiDaysFull) {
      const weekStart = getWeekStart(currentDate);
      const today = new Date();
      const todayStr = `${today.getFullYear()}-${(today.getMonth() + 1).toString().padStart(2, '0')}-${today.getDate().toString().padStart(2, '0')}`;

      let html = `<div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">`;
      
      // Header
      html += `<div class="grid grid-cols-8 border-b border-slate-200 bg-slate-50">`;
      html += `<div class="p-3 text-center text-sm font-medium text-slate-600 border-r border-slate-200">‡πÄ‡∏ß‡∏•‡∏≤</div>`;
      
      for (let i = 0; i < 7; i++) {
        const d = new Date(weekStart);
        d.setDate(d.getDate() + i);
        const dateStr = `${d.getFullYear()}-${(d.getMonth() + 1).toString().padStart(2, '0')}-${d.getDate().toString().padStart(2, '0')}`;
        const isToday = dateStr === todayStr;
        html += `
          <div class="p-3 text-center border-r border-slate-200 ${isToday ? 'bg-indigo-50' : ''}">
            <div class="text-xs text-slate-500">${thaiDaysFull[i]}</div>
            <div class="${isToday ? 'w-8 h-8 mx-auto flex items-center justify-center rounded-full bg-indigo-500 text-white font-semibold' : 'font-semibold text-slate-700'}">${d.getDate()}</div>
          </div>
        `;
      }
      html += `</div>`;

      // Time slots
      html += `<div class="overflow-y-auto" style="max-height: 500px;">`;
      for (let h = 7; h <= 20; h++) {
        html += `<div class="grid grid-cols-8 border-b border-slate-100">`;
        html += `<div class="p-2 text-xs text-slate-500 text-center border-r border-slate-100 bg-slate-50">${h.toString().padStart(2, '0')}:00</div>`;
        
        for (let i = 0; i < 7; i++) {
          const d = new Date(weekStart);
          d.setDate(d.getDate() + i);
          const dateStr = `${d.getFullYear()}-${(d.getMonth() + 1).toString().padStart(2, '0')}-${d.getDate().toString().padStart(2, '0')}`;
          const hourBookings = getFilteredBookings().filter(b => {
            if (b.date !== dateStr) return false;
            const startHour = parseInt(b.start_time.split(':')[0]);
            return startHour === h;
          });

          html += `
            <div class="p-1 min-h-[60px] border-r border-slate-100 time-slot" onclick="openBookingModal('${dateStr}', '${h.toString().padStart(2, '0')}:00')">
              ${hourBookings.map(b => `
                <div onclick="event.stopPropagation(); viewBooking('${b.__backendId}')" class="booking-card ${roomColors[b.room]?.light || 'bg-slate-100'} px-2 py-1 rounded text-xs mb-1 cursor-pointer">
                  <div class="font-medium truncate">${b.title}</div>
                  <div class="text-slate-500">${b.start_time}-${b.end_time}</div>
                </div>
              `).join('')}
            </div>
          `;
        }
        html += `</div>`;
      }
      html += `</div></div>`;

      return html;
    }

    // Render day view
    function renderDayView() {
      const dateStr = `${currentDate.getFullYear()}-${(currentDate.getMonth() + 1).toString().padStart(2, '0')}-${currentDate.getDate().toString().padStart(2, '0')}`;
      const rooms = ['Mind Room', 'Reality Room', 'Power Room', 'Space Room'];
      const filteredRooms = currentRoomFilter === 'all' ? rooms : [currentRoomFilter];

      let html = `<div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">`;
      
      // Header
      html += `<div class="grid border-b border-slate-200 bg-slate-50" style="grid-template-columns: 60px repeat(${filteredRooms.length}, 1fr);">`;
      html += `<div class="p-3 text-center text-sm font-medium text-slate-600 border-r border-slate-200">‡πÄ‡∏ß‡∏•‡∏≤</div>`;
      
      filteredRooms.forEach(room => {
        html += `
          <div class="p-3 text-center border-r border-slate-200">
            <div class="flex items-center justify-center gap-2">
              <span class="w-3 h-3 rounded-full ${roomColors[room].class}"></span>
              <span class="font-medium text-slate-700">${room}</span>
            </div>
          </div>
        `;
      });
      html += `</div>`;

      // Time slots
      html += `<div class="overflow-y-auto" style="max-height: 500px;">`;
      for (let h = 7; h <= 20; h++) {
        html += `<div class="grid border-b border-slate-100" style="grid-template-columns: 60px repeat(${filteredRooms.length}, 1fr);">`;
        html += `<div class="p-2 text-xs text-slate-500 text-center border-r border-slate-100 bg-slate-50">${h.toString().padStart(2, '0')}:00</div>`;
        
        filteredRooms.forEach(room => {
          const hourBookings = bookings.filter(b => {
            if (b.date !== dateStr || b.room !== room) return false;
            const startHour = parseInt(b.start_time.split(':')[0]);
            return startHour === h;
          });

          html += `
            <div class="p-1 min-h-[60px] border-r border-slate-100 time-slot" onclick="openBookingModal('${dateStr}', '${h.toString().padStart(2, '0')}:00', '${room}')">
              ${hourBookings.map(b => `
                <div onclick="event.stopPropagation(); viewBooking('${b.__backendId}')" class="booking-card ${roomColors[b.room]?.light || 'bg-slate-100'} px-2 py-1 rounded text-xs mb-1 cursor-pointer">
                  <div class="font-medium truncate">${b.title}</div>
                  <div class="text-slate-500">${b.start_time}-${b.end_time}</div>
                </div>
              `).join('')}
            </div>
          `;
        });
        html += `</div>`;
      }
      html += `</div></div>`;

      return html;
    }

    // Open booking modal
    function openBookingModal(date = null, time = null, room = null) {
      isEditing = false;
      document.getElementById('modal-title').textContent = '‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°';
      document.getElementById('booking-form').reset();
      document.getElementById('booking-id').value = '';
      document.getElementById('recurrence-group-id').value = '';
      document.getElementById('conflict-warning').classList.add('hidden');
      document.getElementById('recurrence-end-container').classList.add('hidden');
      document.getElementById('date-picker').classList.add('hidden');
      document.getElementById('recurrence-picker').classList.add('hidden');
      
      if (date) {
        document.getElementById('booking-date').value = date;
        document.getElementById('booking-date-display').value = formatDateDisplay(date);
        pickerDate = new Date(date);
      } else {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('booking-date').value = today;
        document.getElementById('booking-date-display').value = formatDateDisplay(today);
        pickerDate = new Date();
      }
      
      if (time) {
        document.getElementById('booking-start').value = time;
        const endHour = parseInt(time.split(':')[0]) + 1;
        document.getElementById('booking-end').value = `${endHour.toString().padStart(2, '0')}:00`;
      } else {
        document.getElementById('booking-start').value = '09:00';
        document.getElementById('booking-end').value = '10:00';
      }
      
      if (room) {
        const radioBtn = document.querySelector(`input[name="room"][value="${room}"]`);
        if (radioBtn) radioBtn.checked = true;
      }
      
      document.getElementById('booking-modal').classList.remove('hidden');
      document.getElementById('booking-modal').classList.add('flex');
    }

    // Close booking modal
    function closeBookingModal() {
      document.getElementById('booking-modal').classList.add('hidden');
      document.getElementById('booking-modal').classList.remove('flex');
      document.getElementById('date-picker').classList.add('hidden');
      document.getElementById('recurrence-picker').classList.add('hidden');
    }

    // Check for conflicts
    function checkConflict() {
      const date = document.getElementById('booking-date').value;
      const start = document.getElementById('booking-start').value;
      const end = document.getElementById('booking-end').value;
      const room = document.querySelector('input[name="room"]:checked')?.value;
      const currentId = document.getElementById('booking-id').value;

      if (!date || !start || !end || !room) {
        document.getElementById('conflict-warning').classList.add('hidden');
        return false;
      }

      const hasConflict = bookings.some(b => {
        if (b.__backendId === currentId) return false;
        if (b.date !== date || b.room !== room) return false;
        
        const bStart = b.start_time;
        const bEnd = b.end_time;
        
        return (start < bEnd && end > bStart);
      });

      if (hasConflict) {
        document.getElementById('conflict-warning').classList.remove('hidden');
      } else {
        document.getElementById('conflict-warning').classList.add('hidden');
      }

      return hasConflict;
    }

    // Generate recurrence dates
    function generateRecurrenceDates(startDate, endDate, type) {
      const dates = [];
      const start = new Date(startDate);
      const end = new Date(endDate);
      let current = new Date(start);

      while (current <= end) {
        dates.push(current.toISOString().split('T')[0]);
        
        switch(type) {
          case 'daily':
            current.setDate(current.getDate() + 1);
            break;
          case 'weekly':
            current.setDate(current.getDate() + 7);
            break;
          case 'biweekly':
            current.setDate(current.getDate() + 14);
            break;
          case 'monthly':
            current.setMonth(current.getMonth() + 1);
            break;
        }
      }

      return dates;
    }

    // Handle booking submit
    async function handleBookingSubmit(e) {
      e.preventDefault();

      if (checkConflict()) {
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß');
        return;
      }

      if (bookings.length >= 999) {
        showToast('‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }

      const submitBtn = document.getElementById('submit-btn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="animate-spin">‚è≥</span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

      const id = document.getElementById('booking-id').value;
      const title = document.getElementById('booking-title').value;
      const room = document.querySelector('input[name="room"]:checked').value;
      const date = document.getElementById('booking-date').value;
      const startTime = document.getElementById('booking-start').value;
      const endTime = document.getElementById('booking-end').value;
      const recurrenceType = document.getElementById('recurrence-type').value;
      const recurrenceEnd = document.getElementById('recurrence-end').value;
      const attendees = document.getElementById('booking-attendees').value;
      const description = document.getElementById('booking-description').value;

      try {
        if (id && isEditing) {
          // Update existing booking
          const existingBooking = bookings.find(b => b.__backendId === id);
          if (existingBooking) {
            const result = await window.dataSdk.update({
              ...existingBooking,
              title,
              room,
              date,
              start_time: startTime,
              end_time: endTime,
              attendees,
              description
            });

            if (result.isOk) {
              showToast('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
            } else {
              showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
            }
          }
        } else {
          // Create new booking(s)
          if (recurrenceType !== 'none' && recurrenceEnd) {
            const dates = generateRecurrenceDates(date, recurrenceEnd, recurrenceType);
            const groupId = Date.now().toString();

            for (const d of dates) {
              if (bookings.length >= 999) break;
              
              const result = await window.dataSdk.create({
                id: `${groupId}-${d}`,
                title,
                room,
                date: d,
                start_time: startTime,
                end_time: endTime,
                recurrence_type: recurrenceType,
                recurrence_end: recurrenceEnd,
                recurrence_group_id: groupId,
                attendees,
                description,
                created_at: new Date().toISOString()
              });

              if (!result.isOk) {
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ã‡πâ‡∏≥');
                break;
              }
            }
            showToast(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ã‡πâ‡∏≥ ${dates.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`);
          } else {
            const result = await window.dataSdk.create({
              id: Date.now().toString(),
              title,
              room,
              date,
              start_time: startTime,
              end_time: endTime,
              recurrence_type: 'none',
              recurrence_end: '',
              recurrence_group_id: '',
              attendees,
              description,
              created_at: new Date().toISOString()
            });

            if (result.isOk) {
              showToast('‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
            } else {
              showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
            }
          }
        }
      } catch (error) {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
      }

      submitBtn.disabled = false;
      submitBtn.innerHTML = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
      closeBookingModal();
    }

    // View booking
    function viewBooking(id) {
      const booking = bookings.find(b => b.__backendId === id);
      if (!booking) return;

      selectedBooking = booking;

      const header = document.getElementById('view-modal-header');
      header.className = `p-6 rounded-t-2xl ${roomColors[booking.room]?.class || 'bg-slate-600'}`;

      document.getElementById('view-title').textContent = booking.title;
      document.getElementById('view-room').textContent = booking.room;
      
      const dateObj = new Date(booking.date);
      document.getElementById('view-date').textContent = `${dateObj.getDate()} ${thaiMonths[dateObj.getMonth()]} ${dateObj.getFullYear() + 543}`;
      document.getElementById('view-time').textContent = `${booking.start_time} - ${booking.end_time}`;

      // Recurrence
      const recurrenceContainer = document.getElementById('view-recurrence-container');
      if (booking.recurrence_type && booking.recurrence_type !== 'none') {
        recurrenceContainer.classList.remove('hidden');
        document.getElementById('view-recurrence').textContent = recurrenceLabels[booking.recurrence_type] || booking.recurrence_type;
        document.getElementById('delete-all-btn').classList.remove('hidden');
      } else {
        recurrenceContainer.classList.add('hidden');
        document.getElementById('delete-all-btn').classList.add('hidden');
      }

      // Attendees
      const attendeesContainer = document.getElementById('view-attendees-container');
      if (booking.attendees) {
        attendeesContainer.classList.remove('hidden');
        document.getElementById('view-attendees').textContent = booking.attendees;
      } else {
        attendeesContainer.classList.add('hidden');
      }

      // Description
      const descContainer = document.getElementById('view-description-container');
      if (booking.description) {
        descContainer.classList.remove('hidden');
        document.getElementById('view-description').textContent = booking.description;
      } else {
        descContainer.classList.add('hidden');
      }

      hideDeleteConfirm();
      document.getElementById('view-modal').classList.remove('hidden');
      document.getElementById('view-modal').classList.add('flex');
    }

    // Close view modal
    function closeViewModal() {
      document.getElementById('view-modal').classList.add('hidden');
      document.getElementById('view-modal').classList.remove('flex');
      selectedBooking = null;
    }

    // Edit booking
    function editBooking() {
      if (!selectedBooking) return;

      isEditing = true;
      closeViewModal();
      
      document.getElementById('modal-title').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á';
      document.getElementById('booking-id').value = selectedBooking.__backendId;
      document.getElementById('booking-title').value = selectedBooking.title;
      document.getElementById('booking-date').value = selectedBooking.date;
      document.getElementById('booking-date-display').value = formatDateDisplay(selectedBooking.date);
      document.getElementById('booking-start').value = selectedBooking.start_time;
      document.getElementById('booking-end').value = selectedBooking.end_time;
      document.getElementById('booking-attendees').value = selectedBooking.attendees || '';
      document.getElementById('booking-description').value = selectedBooking.description || '';
      
      const roomRadio = document.querySelector(`input[name="room"][value="${selectedBooking.room}"]`);
      if (roomRadio) roomRadio.checked = true;

      // Hide recurrence for editing
      document.getElementById('recurrence-type').value = 'none';
      document.getElementById('recurrence-end-container').classList.add('hidden');

      document.getElementById('booking-modal').classList.remove('hidden');
      document.getElementById('booking-modal').classList.add('flex');
    }

    // Show delete confirm
    function showDeleteConfirm() {
      document.getElementById('delete-confirm').classList.remove('hidden');
      document.getElementById('delete-btn').classList.add('hidden');
    }

    // Hide delete confirm
    function hideDeleteConfirm() {
      document.getElementById('delete-confirm').classList.add('hidden');
      document.getElementById('delete-btn').classList.remove('hidden');
    }

    // Delete booking
    async function deleteBooking(mode) {
      if (!selectedBooking) return;

      const buttons = document.querySelectorAll('#delete-options button');
      buttons.forEach(btn => {
        btn.disabled = true;
        btn.innerHTML = '<span class="animate-spin">‚è≥</span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...';
      });

      try {
        if (mode === 'all' && selectedBooking.recurrence_group_id) {
          // Delete all in group
          const groupBookings = bookings.filter(b => b.recurrence_group_id === selectedBooking.recurrence_group_id);
          for (const b of groupBookings) {
            await window.dataSdk.delete(b);
          }
          showToast(`‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ã‡πâ‡∏≥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${groupBookings.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`);
        } else {
          // Delete single
          const result = await window.dataSdk.delete(selectedBooking);
          if (result.isOk) {
            showToast('‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
          } else {
            showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
          }
        }
      } catch (error) {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
      }

      closeViewModal();
    }

    // Show toast
    function showToast(message) {
      const toast = document.getElementById('toast');
      document.getElementById('toast-message').textContent = message;
      toast.classList.remove('translate-y-20', 'opacity-0');
      
      setTimeout(() => {
        toast.classList.add('translate-y-20', 'opacity-0');
      }, 3000);
    }

    // Initialize on load
    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cd0f2bef5067331',t:'MTc3MDk1MDI5Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
